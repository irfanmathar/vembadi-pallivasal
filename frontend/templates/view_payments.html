{% extends 'base1.html' %}
{% block content %}
<style>
    .filter-box {
        background: #ffffff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        border-left: 5px solid #2E7D32; /* green border */
    }
    .filter-label {
        font-weight: bold;
        color: #2E7D32;
        margin-bottom: 5px;
        font-size: 14px;
    }
</style>

<div class="filter-box">
    <form method="GET">
        <div class="row align-items-end">

            <!-- Date Filter -->
            <div class="col-md-4">
                <label class="filter-label">Select Date</label>
                <input 
                    type="date" 
                    name="date" 
                    class="form-control" 
                    value="{{ request.GET.date|default:today }}">
            </div>

            <!-- Bill ID Filter -->
            <div class="col-md-4">
                <label class="filter-label">Bill ID</label>
                <input 
                    type="text" 
                    name="bill_id" 
                    class="form-control" 
                    placeholder="Enter Bill ID"
                    value="{{ request.GET.bill_id }}">
            </div>

            <!-- Filter Button -->
            <div class="col-md-2 mt-2">
                <button type="submit" class="btn btn-success w-100">üîç Filter</button>
            </div>

            <!-- Clear Filters -->
            {% if request.GET.date or request.GET.bill_id %}
            <div class="col-md-2 mt-2">
                <a href="{{ request.path }}" class="btn btn-secondary w-100">‚ùå Clear</a>
            </div>
            {% endif %}

        </div>
    </form>
</div>

<div class="container mt-4">
    <h3>Payment History ‚Äì {{ member.name }}</h3>
    {% if messages %}
<div class="container mt-3">
    {% for message in messages %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    {% endfor %}
</div>
{% endif %}


    <table class="table table-bordered table-striped mt-3">
        <thead>
            <tr>
                <th>Bill ID</th>
                <th>Date</th>
                <th>Time</th>
                <th>Amount</th>
                <th>Reason</th>
                {% if request.user.is_superuser == 1 %}
        <th>Action</th>
        {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for p in payments %}
            <tr>
                <td>{{ p.id }}</td>
                <td>{{ p.date|date:"Y-m-d" }}</td>
                <td>{{ p.date|time:"h:i A" }}</td>
                <td>‚Çπ{{ p.amount }}</td>
                <td>{{ p.reason }}</td>
                {% if request.user.is_superuser %}
    <td class="text-center">
        <form method="post"
              action="{% url 'delete_payment' p.id %}"
              onsubmit="return confirm('Are you sure you want to delete this payment?');">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm btn-danger">
                üóë Delete
            </button>
        </form>
    </td>
    {% endif %}
            </tr>
            {% empty %}
            <tr>
                <td colspan="{% if request.user.is_superuser == 1 %}6{% else %}5{% endif %}"
    class="text-center text-danger">
    No payments found.
</td>

            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h4 class="mt-3" style="color:#2E7D32; font-weight:bold;">
        Total Paid Amount: ‚Çπ{{ total }}
    </h4>

    <a href="{% url 'download_payment_summary' member.id %}?{% if request.GET.date %}date={{ request.GET.date }}&{% endif %}{% if request.GET.bill_id %}bill_id={{ request.GET.bill_id }}{% endif %}" 
   class="btn btn-success mt-3">
    üìÑ Download Payment Summary
</a>


</div>
{% endblock %}
